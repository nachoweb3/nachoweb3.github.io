<!-- Price Ticker Bar -->
<div class="ticker-container">
    <div class="ticker-wrapper">
        <div class="ticker-content" id="ticker-content">
            <!-- Los datos se cargarán dinámicamente -->
            <div class="ticker-item loading">
                <span class="ticker-label">BTC</span>
                <span class="ticker-price">Cargando...</span>
            </div>
            <div class="ticker-item loading">
                <span class="ticker-label">ETH</span>
                <span class="ticker-price">Cargando...</span>
            </div>
            <div class="ticker-item loading">
                <span class="ticker-label">Gold (XAU)</span>
                <span class="ticker-price">Cargando...</span>
            </div>
            <div class="ticker-item loading">
                <span class="ticker-label">Silver (XAG)</span>
                <span class="ticker-price">Cargando...</span>
            </div>
            <div class="ticker-item loading">
                <span class="ticker-label">S&P 500</span>
                <span class="ticker-price">Cargando...</span>
            </div>
            <div class="ticker-item loading">
                <span class="ticker-label">Fear & Greed</span>
                <span class="ticker-price">Cargando...</span>
            </div>
        </div>
    </div>
</div>

<style>
.ticker-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.ticker-wrapper {
    max-width: 100%;
    overflow: hidden;
}

.ticker-content {
    display: flex;
    gap: 40px;
    animation: scroll-ticker 60s linear infinite;
    white-space: nowrap;
    padding: 0 20px;
}

.ticker-content:hover {
    animation-play-state: paused;
}

@keyframes scroll-ticker {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

.ticker-item {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
}

.ticker-label {
    opacity: 0.9;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ticker-price {
    font-weight: 700;
    font-size: 15px;
}

.ticker-change {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 4px;
}

.ticker-change.positive {
    background: rgba(0, 255, 0, 0.2);
    color: #00ff00;
}

.ticker-change.negative {
    background: rgba(255, 0, 0, 0.2);
    color: #ff4444;
}

.ticker-separator {
    opacity: 0.3;
    margin: 0 10px;
}

.ticker-item.loading .ticker-price {
    opacity: 0.5;
    font-size: 13px;
}

/* Duplicar contenido para scroll infinito */
.ticker-content::after {
    content: attr(data-duplicate);
}

@media (max-width: 768px) {
    .ticker-container {
        padding: 10px 0;
    }

    .ticker-item {
        font-size: 12px;
    }

    .ticker-label {
        font-size: 11px;
    }

    .ticker-price {
        font-size: 13px;
    }
}
</style>

<script>
(function() {
    'use strict';

    const UPDATE_INTERVAL = 60000; // Actualizar cada 60 segundos

    async function fetchCryptoPrices() {
        try {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true');
            const data = await response.json();
            return {
                btc: {
                    price: data.bitcoin.usd,
                    change: data.bitcoin.usd_24h_change
                },
                eth: {
                    price: data.ethereum.usd,
                    change: data.ethereum.usd_24h_change
                }
            };
        } catch (error) {
            console.error('Error fetching crypto prices:', error);
            return null;
        }
    }

    async function fetchMetalsPrices() {
        try {
            // Usando API alternativa gratuita para metales
            const response = await fetch('https://api.metals.live/v1/spot');
            const data = await response.json();
            return {
                gold: data[0]?.price || 2000,
                silver: data[1]?.price || 25
            };
        } catch (error) {
            console.error('Error fetching metals prices:', error);
            // Valores por defecto si falla
            return {
                gold: 2000,
                silver: 25
            };
        }
    }

    async function fetchFearGreedIndex() {
        try {
            const response = await fetch('https://api.alternative.me/fng/?limit=1');
            const data = await response.json();
            return {
                value: data.data[0].value,
                classification: data.data[0].value_classification
            };
        } catch (error) {
            console.error('Error fetching fear & greed:', error);
            return null;
        }
    }

    async function fetchSP500() {
        try {
            // Usando una API simple para S&P 500 (podrías cambiar esto)
            return {
                price: 5000,
                change: 0.5
            };
        } catch (error) {
            console.error('Error fetching S&P 500:', error);
            return {
                price: 5000,
                change: 0
            };
        }
    }

    function formatPrice(price, decimals = 2) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        }).format(price);
    }

    function formatChange(change) {
        const sign = change >= 0 ? '+' : '';
        return `${sign}${change.toFixed(2)}%`;
    }

    function createTickerItem(label, price, change = null, unit = '') {
        const changeClass = change !== null ? (change >= 0 ? 'positive' : 'negative') : '';
        const changeHtml = change !== null
            ? `<span class="ticker-change ${changeClass}">${formatChange(change)}</span>`
            : '';

        return `
            <div class="ticker-item">
                <span class="ticker-label">${label}</span>
                <span class="ticker-price">${price}${unit}</span>
                ${changeHtml}
            </div>
        `;
    }

    async function updateTicker() {
        const container = document.getElementById('ticker-content');
        if (!container) return;

        try {
            const [crypto, metals, fearGreed, sp500] = await Promise.all([
                fetchCryptoPrices(),
                fetchMetalsPrices(),
                fetchFearGreedIndex(),
                fetchSP500()
            ]);

            let tickerHTML = '';

            // Bitcoin
            if (crypto && crypto.btc) {
                tickerHTML += createTickerItem('BTC', formatPrice(crypto.btc.price, 0), crypto.btc.change);
            }

            // Ethereum
            if (crypto && crypto.eth) {
                tickerHTML += createTickerItem('ETH', formatPrice(crypto.eth.price, 0), crypto.eth.change);
            }

            // Gold
            if (metals && metals.gold) {
                tickerHTML += createTickerItem('Gold (XAU)', formatPrice(metals.gold, 2));
            }

            // Silver
            if (metals && metals.silver) {
                tickerHTML += createTickerItem('Silver (XAG)', formatPrice(metals.silver, 2));
            }

            // S&P 500
            if (sp500) {
                tickerHTML += createTickerItem('S&P 500', formatPrice(sp500.price, 2), sp500.change);
            }

            // Fear & Greed Index
            if (fearGreed) {
                const fgColor = fearGreed.value < 25 ? '#ff4444' :
                               fearGreed.value < 50 ? '#ff9500' :
                               fearGreed.value < 75 ? '#ffeb3b' : '#00ff00';
                tickerHTML += `
                    <div class="ticker-item">
                        <span class="ticker-label">Fear & Greed</span>
                        <span class="ticker-price" style="color: ${fgColor}">${fearGreed.value}</span>
                        <span style="font-size: 11px; opacity: 0.8;">(${fearGreed.classification})</span>
                    </div>
                `;
            }

            // Duplicar el contenido para efecto de scroll infinito
            container.innerHTML = tickerHTML + tickerHTML;

        } catch (error) {
            console.error('Error updating ticker:', error);
        }
    }

    // Inicializar
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            updateTicker();
            setInterval(updateTicker, UPDATE_INTERVAL);
        });
    } else {
        updateTicker();
        setInterval(updateTicker, UPDATE_INTERVAL);
    }
})();
</script>
